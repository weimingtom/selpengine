<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html  xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh" lang="zh">
<!-- generated by to_html.pl from Var.xml -->
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>变量的使用</title>
	<meta name="author" content="W.Dee" />
	<meta http-equiv="Content-Style-Type" content="text/css" />
	<meta http-equiv="Content-Script-Type" content="text/javascript" />
	<link href="browser.css" type="text/css" rel="stylesheet" title="åéåéç¸å³æ ååèæ ·å¼" />
	<link href="mailto:dee@kikyou.info" rev="Made" />
	<link href="index.html" target="_top" rel="Start" title="é¦é¡µ" />
</head>
<body>
<h1><a id="id312" name="id312">变数嘛…</a>
</h1><div class="para"><div>
<br />
　KAG 中所谓的变数其实就是、<br />
<br />
・记录某些数据的东西<br />
<br />
　而已。<br />
<br />
　但是呢、KAG 因为是基于 <a id="id313" name="id313" class="targanchor"><dfn>TJS2</dfn></a> 这一脚本语言的系统、KAG 的变数实际上继承了 TJS2 变数的功能，可以发挥很强大的作用。（译注：口胡，给我一个能保存的数据类再说……）<br />
<br />
　这个初级教程只讲了些基本的用法、像 KAG 内部的方法、属性之类的操作、使用吉里吉里本体功能之类的没有详细说、完全是<em>一片泥沼</em>的状态、容易掉坑的请注意(笑)。<br />
</div></div>
<h1><a id="id314" name="id314">变数的种类</a>
</h1><div class="para"><div>
　KAG 变数的种类一共有 3 种。随着游戏档案存取的普通的「<a id="id315" name="id315" class="targanchor"><dfn>游戏变数</dfn></a>」と、和游戏档案的存取无关的、可以一直被记录的「<a id="id316" name="id316" class="targanchor"><dfn>系统变数</dfn></a>」、临时记录用的「<a id="id317" name="id317" class="targanchor"><dfn>临时变数</dfn></a>」。「系统变数」在吉里吉里/KAG 程序关闭之后、再执行这个游戏的话，内容依然保留。「临时变数」在关闭游戏后即自动清除、也不会被游戏存档记录。<br />
<br />
　游戏变数以 <a id="id318" name="id318" class="targanchor"><dfn>f</dfn></a> 、系统变数以 <a id="id319" name="id319" class="targanchor"><dfn>sf</dfn></a> 、临时变数以 <a id="id320" name="id320" class="targanchor"><dfn>tf</dfn></a> 作为名字的开头。<br />
<br />
　此外、KAG ( 其实也就是 TJS2 ) 的变数、可以记录文字列或者数值 ( 文字列数值一类的、变数中记录的内容种类即是所谓的「<a id="id321" name="id321" class="targanchor"><dfn>类型</dfn></a>」 )。变数的命名相当自由，变数的个数没有限制。存储的文字列没有长度限制，数值的话也支持实数等等。<br />
　KAG 3.x 之后「数组」和「字典」也可以使用了 ( 在这个文档里没有说明 )。<br />
<br /><div class="note"><div class="notehead"><span class="noteheadspan">Note</span></div>
　TJS2 的整数型为 64bit、实数型为 double ( 双精度 ) 。<br />
　文字列支持以0为终结符的 UNICODE 文字列、没有长度限制。<br />
</div><br />
</div></div>
<h1><a id="id322" name="id322">变数命名的规定</a>
</h1><div class="para"><div>
　吉里吉里 / KAG 中、变数的命名是相当自由的。但是、再怎么自由，吉里吉里 / KAG 可以使用的变数名字还是有一定规则的。<br />
<br />
<dl>
<dt>变数名可以使用半角英数和全角文字、_ (下划线) </dt>
<dd>　<em><code class="inlinecode">abc&amp;def</code></em> 或者、<em><code class="inlinecode">a-z</code></em> 像这样的变数名不能用。<br />
　<em><code class="inlinecode">final_count</code></em> 像这样含有下划线、<em><code class="inlinecode">主人公的名字</code></em> 这样使用全角文字都是可以的(全角記号也全部可以用于给变数明明)。</dd>
<dt>不过要注意 变数名不能以半角数字开头</dt>
<dd>　<em><code class="inlinecode">2friends</code></em> 或者 <em><code class="inlinecode">3com</code></em> 像这样的变数名不能用 ( 全角数字开头的话就 OK )。</dd></dl><br />
　这些变数名的前面、游戏变数的话就加上 <em><code class="inlinecode">f.</code></em> を、系统变数的话就加上 <em><code class="inlinecode">sf.</code></em> 、临时变数则加上 <em><code class="inlinecode">tf.</code></em> 。<br />
　例如、以下这些变数名。<br />
<br />
<code class="inlinecode"> <em>f.flag1  sf.username  sf.playcount  tf.i  f.enokazu  f.变数その１ </em>...</code><br />
<br />
　此外、第一次使用变数（等于是变数刚创建的时候），变数的内容默认为 0 、对文字列来说就是 '' ( 空文字列 ) 、这是有点特殊的状态。一般情况下、第一次使用这个变数的时候，请给变数赋一个值比较好。<br />
<br />
<br /><div class="note"><div class="notehead"><span class="noteheadspan">Note</span></div>
　<em>f</em> 或者 <em>sf</em> 或者 <em>tf</em> 之外还有 <em>kag</em> 开头的变数、<em>kag</em> 开头的变数，可以对 KAG 的系统内部一些数值进行操作（比如说kag.fullsreen，代表窗口是否处在全屏状态）。<br />
</div><br />
</div></div>
<h1><a id="id323" name="id323">变数的代入</a>
</h1><div class="para"><div>
　要对变数赋値、通常使用 <a id="id324" name="id324" class="targanchor"><dfn>eval</dfn></a> 指令。例如、想把 1000 代入变数 <code class="inlinecode">f.flag1</code> 的话・・・<br />

<br />
<code class="bq">[eval&nbsp;exp=&quot;<em>f.flag1&nbsp;<a id="id325" name="id325" class="targanchor"><dfn>=</dfn></a>&nbsp;1000</em>&quot;]<br />
</code>
<br />

　就像以上这样。也就是、变数名之后写上 = （等号）、之后写上想要代入的数值。<br />
<br />
　想要代入文字的话、<br />

<br />
<code class="bq">[eval&nbsp;exp=&quot;<em>f.变数之１&nbsp;=&nbsp;'文字列'</em>&quot;]<br />
</code>
<br />

　则是像以上这样。也就是、 = 之后要使用 '' 把想代入的文字列括起来 ( 请注意单引号和双引号的差别哦 )。<br />
　没有文字列用的变数、数值用变数这样的差别、变数类型会随着值的类型变化而自动改变。<br />
<br />
　给一个变数赋其他变数的值、<br />

<br />
<code class="bq">[eval&nbsp;exp=&quot;<em>f.flag1&nbsp;=&nbsp;f.flag2</em>&quot;]<br />
</code>
<br />

<br />
则是像以上这样写。<br />
</div></div>
<h1><a id="id326" name="id326">变数的演算</a>
</h1><div class="para"><div>
<br />
　想要对某些变数进行计算的情况、<br />

<br />
<code class="bq">[eval&nbsp;exp=&quot;<em>f.flag1&nbsp;=&nbsp;f.flag1&nbsp;+&nbsp;1</em>&quot;]<br />
</code>
<br />

　也是一样的。在这个例子中、会将 f.flag1 加 1 后的值代入 f.flag1  ( 也就是相当于 f.flag1 的值加上了 1  )。<br />
　exp 属性就是用来书写 TJS2 相关的「<a id="id327" name="id327" class="targanchor"><dfn>式</dfn></a>」的。<br />
　TJS 式中、<a id="id328" name="id328" class="targanchor"><dfn>*</dfn></a>(乘) <a id="id329" name="id329" class="targanchor"><dfn>/</dfn></a>(除) <a id="id330" name="id330" class="targanchor"><dfn>+</dfn></a>(加) <a id="id331" name="id331" class="targanchor"><dfn>-</dfn></a>(减) 之类的 <a id="id332" name="id332" class="targanchor"><dfn>演算子</dfn></a>照常规使用 ( 和数学式一样，有计算的优先顺序，例如乘除优先于加减 )。在式子中也可以使用 (  )  括号。<br />
　例如、<br />

<br />
<code class="bq">[eval&nbsp;exp=&quot;<em>f.flag1&nbsp;=&nbsp;f.flag1&nbsp;+&nbsp;f.flag2&nbsp;*&nbsp;f.flag3</em>&quot;]<br />
</code>
<br />

　这样的话、f.flag2 和 f.flag3 的乘积加上 f.flag1 的和将被代入 f.flag1 。<br />
<br />
　除法计算的话则是使用 / (斜线) 符号。<br />

<br />
<code class="bq">[eval&nbsp;exp=&quot;<em>f.flag1&nbsp;=&nbsp;f.flag2&nbsp;/&nbsp;f.flag3</em>&quot;]<br />
</code>
<br />

　以上的例子 f.flag2 除以 f.flag3 的商将被代入 f.flag1 。<br />
　但是、除不尽的情况下， f.flag1 的值将会是实数、假如想要获得整数值的话、请使用整数除算演算子 \ 、<br />

<br />
<code class="bq">[eval&nbsp;exp=&quot;<em>f.flag1&nbsp;=&nbsp;f.flag2&nbsp;\&nbsp;f.flag3</em>&quot;]<br />
</code>
<br />

　写成以上这样。<br />
<br />
<br />
　此外、文字列之间的计算，也可以使用 + 演算子。<br />
<br />

<br />
<code class="bq">[eval&nbsp;exp=&quot;f.flag2&nbsp;=&nbsp;'hoge'&quot;]<br />
[eval&nbsp;exp=&quot;f.flag3&nbsp;=&nbsp;'une'&quot;]<br />
[eval&nbsp;exp=&quot;<em>f.flag1=&nbsp;f.flag2&nbsp;+&nbsp;f.flag3</em>&quot;]<br />
</code>
<br />

　像上面的例子、 f.flag1 的值将会是 'hogeune' 。<br />
<br />
<br /><div class="note"><div class="notehead"><span class="noteheadspan">Note</span></div>
　TJS2 的语法是参考 JavaScript (ECMAScript) 设计的、这些方面非常相似 ( 但并不是完全相同 )。<br />
　通常的算术演算动作等等是基本相同的。文字列之间的计算或者文字列和数值的混合计算也基本相同。<br />
</div><br />
</div></div>
<h1><a id="id333" name="id333">文字列和数值</a>
</h1><div class="para"><div>
　KAG 的变数、并不会有文字列类、数值类的强制区别，变数一旦建立，名字也不会改变。<br />
　当把文字列赋给变数时，就成为保存文字列用的变数、把数值赋给变数时，就成为保存数值用的变数。<br />
　最麻烦的是进行混用的时候。比如说，+ 这个符号就有了很多很多的意义(^^;<br />
<br />
　文字列与文字列和并会使用到 + 演算子、数值的加法也会使用到 + 演算子、文字列和数值混合计算的场合、如果参与计算的其中一个是文字列、那么其他的数值也会被自动转换成文字列。<br />
<br />
　例如、f.flag2 内记录的是 'hoge' 这个文字列、f.flag3 则记录着 10 这个数值、<br />

<br />
<code class="bq">[eval&nbsp;exp=&quot;<em>f.flag1&nbsp;=&nbsp;f.flag2&nbsp;+&nbsp;f.flag2</em>&quot;]<br />
</code>
<br />

　那么、f.flag1 里记录的会是 'hoge10' 这个文字列。<br />
<br />
　此外、如果无论如何都希望把文字列转为数值的话，也是有办法的。例如使用 [input] 指令让玩家输入数字、这种情况下也是使用 + 演算子。把+ 演算子放在想转换成数值的内容之前。例如、f.flag1 中记录着 '20' 这个文字列、<br />
<br />

<br />
<code class="bq">[eval&nbsp;exp=&quot;<em>f.flag1&nbsp;=&nbsp;+f.flag1</em>&quot;]<br />
</code>
<br />

<br />
　这么写的话、f.flag1 的内容就会转换为数值、再次记入 f.flag1 中。f.flag1 现在记录的就是数值型的 20 。<br />
<br />
<br /><div class="note"><div class="notehead"><span class="noteheadspan">Note</span></div>
　+ 演算子连写的情况也必须注意。想把 f.flag3 变为数值型，并和 f.flag2 相加的话、写成 <code class="inlinecode">f.flag2++f.flag3</code> 这种形式是会出错的 (因为 ++ 是另外一个演算子 )。请在加号间空一格，写成 <code class="inlinecode">f.flag2+ +f.flag3</code> 的形式。<br />
</div><br />
<br /><div class="note"><div class="notehead"><span class="noteheadspan">Note</span></div>
　单个的 + 演算子 ( 如之前举例的 <code class="inlinecode">f.flag1 = +f.flag1</code> 例子中的 + ) 、文字列内如果有着小数点 ( 0.3 之类 ) 的话、结果会转换成实数。想要结果变为整数 ( 小数点以下舍去 )、写成 int + 的话就 OK 了。还是以之前的例子示范、就是写成 <code class="inlinecode">f.flag1 = int +f.flag1</code> 这样。<br />
</div><br />
</div></div>
<h1><a id="id334" name="id334">变数的删除・其他</a>
</h1><div class="para"><div>
　想要删除变数的话就使用 <a id="id335" name="id335" class="targanchor"><dfn>delete</dfn></a> 来进行。<em>delete 变数名</em> 这么写的话就可以把变数删除。<br />
　例如、想要删除 <code class="inlinecode">f.flag1</code> 的话、<br />

<br />
<code class="bq">[eval&nbsp;exp=&quot;<em>delete&nbsp;f.flag1</em>&quot;]<br />
</code>
<br />

　就写成这样。<br />
<br />
　此外、使用 <a id="id336" name="id336" class="targanchor"><dfn>clearvar</dfn></a> 指令的话、可以把所有游戏变数（f.开头的变数）全部删除。<br />
<br />
　此外、TJS2 中还可以使用一些其他演算子， math 对象，三角函数等等相关的计算 ( 也不知道是不是有用呢 ) 。详细的说明请看吉里吉里 SDK 的 TJS2 说明文档。<br />
<br />
　使用 <a id="id337" name="id337" class="targanchor"><dfn>,</dfn></a> (逗号)的话，可以在一个 eval 指令内写入多个计算式。<br />
比如说、<br />

<br />
<code class="bq">[eval&nbsp;exp=&quot;f.first=true&quot;]<br />
[eval&nbsp;exp=&quot;f.flag0=0&quot;]<br />
[eval&nbsp;exp=&quot;f.flag1=0&quot;]<br />
</code>
<br />

　这三个式子、可以简写成以下的样子。<br />

<br />
<code class="bq">[eval&nbsp;exp=&quot;f.first=true<em>,</em>&nbsp;f.flag0=0<em>,</em>&nbsp;f.flag1=0&quot;]<br />
</code>
<br />

<br />
　此外、使用 <a id="id338" name="id338" class="targanchor"><dfn>iscript</dfn></a> 指令、可以代替连续的 eval 指令，让格式变得简单。<br />
<br />
　例如、还是之前的三个式子、<br />
<br />

<br />
<code class="bq">[iscript]<br />
f.first=true<em>;</em><br />
f.flag0=0<em>;</em><br />
f.flag1=0<em>;</em><br />
[endscript]<br />
</code>
<br />

<br />
　可以写成以上这样。各式的后面，请千万不要忘记写上 ; ( 分号 ) 哦。<br />
　像这样使用 , (逗号) 或者 iscript 来书写代码，效率会提高很多。<br />
</div></div>
<h1><a id="id339" name="id339">显示变数的内容</a>
</h1><div class="para"><div>
　想要在剧本中表示变数的内容、请使用 <a id="id340" name="id340" class="targanchor"><dfn>emb</dfn></a> 指令。<br />
　例如说、像以下这样。<br />

<br />
<code class="bq">[wait&nbsp;time=200]<br />
*start<br />
[cm]<br />
[eval&nbsp;exp=&quot;f.数值=200&quot;][eval&nbsp;exp=&quot;f.mojiretu='文字列'&quot;]<br />
f.数值&nbsp;的内容&nbsp;:&nbsp;[emb&nbsp;exp=&quot;f.数值&quot;][l][r]<br />
f.mojiretu&nbsp;的内容&nbsp;:&nbsp;[emb&nbsp;exp=&quot;f.mojiretu&quot;][l][r]<br />
</code>
<br />

<br />
　执行起来的话，游戏画面上会显示出：<br />
<br />
f.数值 的内容 : 200<br />
f.mojiretu 的内容 : 文字列<br />
<br />
　这样的对话。<br />
</div></div>
<h1><a id="id341" name="id341">实体（entity）</a>
</h1><div class="para"><div>
　所谓的实体（entity）是指、以变数的内容、替换其他指令的属性值的功能。<br />
　书写格式是、属性名 = <a id="id342" name="id342" class="targanchor"><dfn>&amp;</dfn></a> 变数名。<br />

<br />
<code class="bq">[wait&nbsp;time=200]<br />
*start<br />
[cm]<br />
[eval&nbsp;exp=&quot;f.fontsize=60&quot;]<br />
[font&nbsp;size=&quot;&amp;f.fontsize&quot;]这是60号的文字[resetfont]<br />
</code>
<br />

<br />
　这种情况下、f.fontsize 里记录的 60 这个值、就成为了 font 指令的 size 属性值。<br />
<br />
　实体的本质是：对 &amp; 之后的部分进行计算，并将计算结果作为属性值。也就是说、&amp; 的后面，除了变数名以外，也可以写入 TJS 式。<br />
</div></div>

<h1><a id="id343" name="id343">条件判断</a>
</h1><div class="para"><div>
　要判断变数和某个值是否相同，可以使用以下的演算子。<br />

<br />
<code class="bq">a<a id="id344" name="id344" class="targanchor"><dfn>==</dfn></a>b&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;和&nbsp;b&nbsp;相等的情况下为真(true)<br />
a<a id="id345" name="id345" class="targanchor"><dfn>!=</dfn></a>b&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;和&nbsp;b&nbsp;不相等的情况下为真(true)<br />
a<a id="id346" name="id346" class="targanchor"><dfn>&lt;</dfn></a>b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;小于&nbsp;b&nbsp;的情况下为真(true)<br />
a<a id="id347" name="id347" class="targanchor"><dfn>&gt;</dfn></a>b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;大于&nbsp;b&nbsp;的情况下为真(true)<br />
</code>
<br />

<br />
　此外也可以使用 &gt;= や &lt;= (大于等于、小于等于) 。<br />
　像这样的条件判断，主要是用在 if 指令中的。<br />
<br />
　<a id="id348" name="id348" class="targanchor"><dfn>if</dfn></a> 指令是、如果 exp 属性的值为 真(true) ，就执行从if 到 endif 中间的剧本段内容。<br />
<br />

<br />
<code class="bq">[if&nbsp;exp=&quot;f.flag1<em>==</em>2&quot;]f.flag1&nbsp;的值是&nbsp;2&nbsp;[endif]<br />
[if&nbsp;exp=&quot;f.flag1<em>!=</em>2&quot;]f.flag1&nbsp;的值不是&nbsp;2&nbsp;[endif]<br />
</code>
<br />

<br />
　变数的用途非常广泛，拥有很强大的功能。<br />
</div></div>
	<script type="text/javascript" charset="UTF-8" src="documentid.js" ></script>
	<script type="text/javascript" charset="UTF-8" src="postcontent.js" ></script>
</body>
</html>
